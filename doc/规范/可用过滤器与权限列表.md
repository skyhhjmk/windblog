# 可用过滤器 与权限列表

说明：Filter 为变换式钩子，插件可对传入值进行修改。权限采用分域前缀，未授权过滤器默认拒绝修改（返回原值）。

约定：
- 权限项形如：{domain}:filter.{name}
- 支持通配授权：{domain}:filter.*（请谨慎使用）

## 响应/请求

- response_filter
  - 场景：响应发出前允许变更 Response
  - 输入：Response $response
  - 输出：Response $response
  - 权限：response:filter.modify

## 内容渲染

- content.filter
  - 场景：内容渲染前，对 HTML/Markdown 进行处理
  - 输入：string $html
  - 输出：string $html
  - 权限：content:filter.render
- post.content_filter
  - 场景：文章正文渲染前
  - 输入：string $content, Post $post?
  - 输出：string $content
  - 权限：post:filter.content
- page.content_filter
  - 输入：string $content, Page $page?
  - 输出：string $content
  - 权限：page:filter.content

## 模板 / Twig / 组件

- template.vars_filter
  - 场景：Twig 渲染前调整变量
  - 输入：array $vars, string $template
  - 输出：array $vars
  - 权限：template:filter.vars
- widget.output_filter
  - 场景：组件输出过滤
  - 输入：string $html, string $widget
  - 输出：string $html
  - 权限：widget:filter.output
- sidebar.items_filter
  - 场景：侧边栏条目过滤
  - 输入：array $items
  - 输出：array $items
  - 权限：sidebar:filter.items

## 媒体 / URL

- media.url_filter
  - 场景：生成媒体访问 URL 时
  - 输入：string $url, Media $media?
  - 输出：string $url
  - 权限：media:filter.url
- url.generate_filter
  - 场景：系统生成 URL 时
  - 输入：string $url, array $params
  - 输出：string $url
  - 权限：url:filter.generate

## 搜索 / 分页

- search.query_filter
  - 场景：搜索查询前对条件进行调整
  - 输入：array $query
  - 输出：array $query
  - 权限：search:filter.query
- pagination.page_size_filter
  - 场景：决定每页条目数
  - 输入：int $size
  - 输出：int $size
  - 权限：pagination:filter.page_size

## 评论

- comment.content_filter
  - 场景：评论内容渲染前
  - 输入：string $content, Comment $comment?
  - 输出：string $content
  - 权限：comment:filter.content

## I18N / 语言

- i18n.translate_filter
  - 场景：翻译文本输出前
  - 输入：string $text, string $key, string $locale
  - 输出：string $text
  - 权限：i18n:filter.translate

## 邮件 / 队列 / Webhook

- mail.message_filter
  - 场景：邮件消息体发送前
  - 输入：array $message
  - 输出：array $message
  - 权限：mail:filter.message
- mq.payload_filter
  - 场景：MQ 发布前调整负载
  - 输入：array $payload, string $topic
  - 输出：array $payload
  - 权限：mq:filter.payload
- webhook.payload_filter
  - 场景：调用外部 Webhook 前
  - 输入：array $payload, string $endpoint
  - 输出：array $payload
  - 权限：webhook:filter.payload

> 说明：上述过滤器需在相应控制器/服务的关键路径中调用 PluginService::apply_filters() 接入；PluginService::ensurePermission(slug, '{domain}:filter.{name}') 未通过时应直接返回原值以保证安全。