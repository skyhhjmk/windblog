{% extends "widgets/base.html.twig" %}

{% block widget_content %}
    {% if tags is defined and tags is not empty %}
        {% set visible = params.visible|default(30) %}
        {% set primary_tags = tags|slice(0, visible) %}
        {% set extra_tags = tags|slice(visible) %}

        {# 柔和渐变色池 #}
        {% set gradients = [
            'bg-gradient-to-r from-indigo-200 via-purple-200 to-pink-200 text-indigo-700 hover:from-indigo-300 hover:via-purple-300 hover:to-pink-300',
            'bg-gradient-to-r from-sky-200 via-cyan-200 to-teal-200 text-sky-700 hover:from-sky-300 hover:via-cyan-300 hover:to-teal-300',
            'bg-gradient-to-r from-amber-200 via-orange-200 to-rose-200 text-amber-700 hover:from-amber-300 hover:via-orange-300 hover:to-rose-300',
            'bg-gradient-to-r from-lime-200 via-green-200 to-emerald-200 text-green-700 hover:from-lime-300 hover:via-green-300 hover:to-emerald-300',
            'bg-gradient-to-r from-fuchsia-200 via-pink-200 to-rose-200 text-fuchsia-700 hover:from-fuchsia-300 hover:via-pink-300 hover:to-rose-300',
            'bg-gradient-to-r from-blue-200 via-indigo-200 to-violet-200 text-blue-700 hover:from-blue-300 hover:via-indigo-300 hover:to-violet-300'
        ] %}

        <div class="flex flex-wrap gap-2">
            {% for tag in primary_tags %}
                {% set seed = loop.index0 * 17 + (tag.id|default(0) * 13) %}
                {% set angle = (seed % 11) - 5 %}
                {% set opacity = 0.90 + ((seed % 10) * 0.01) %}
                {% set gradient = gradients[seed % gradients|length] %}

                <a href="/tag/{{ tag.slug }}.html"
                   class="text-sm px-3 py-1 rounded-full border border-white/60 shadow-sm transition-all duration-150 {{ gradient }} hover:shadow-md"
                   style="transform: rotate({{ angle }}deg); opacity: {{ opacity|number_format(2) }}; will-change: transform, opacity;"
                   onmouseover="this.style.transform='rotate(0deg) scale(1.05)'"
                   onmouseout="this.style.transform='rotate({{ angle }}deg) scale(1)'">
                    {{ tag.name }} ({{ tag.posts_count|default(0) }})
                </a>
            {% endfor %}
        </div>

        {% if extra_tags is not empty %}
            <details class="mt-3 group">
                <summary class="cursor-pointer text-sm text-gray-600 hover:text-blue-600 transition-colors select-none">
                    更多标签
                </summary>
                <div class="mt-2 flex flex-wrap gap-2">
                    {% for tag in extra_tags %}
                        {% set seed = (loop.index0 + primary_tags|length) * 17 + (tag.id|default(0) * 13) %}
                        {% set angle = (seed % 11) - 5 %}
                        {% set opacity = 0.90 + ((seed % 10) * 0.01) %}
                        {% set gradient = gradients[seed % gradients|length] %}

                        <a href="/tag/{{ tag.slug }}.html"
                           class="text-sm px-3 py-1 rounded-full border border-white/60 shadow-sm transition-all duration-150 {{ gradient }} hover:shadow-md"
                           style="transform: rotate({{ angle }}deg); opacity: {{ opacity|number_format(2) }}; will-change: transform, opacity;"
                           onmouseover="this.style.transform='rotate(0deg) scale(1.05)'"
                           onmouseout="this.style.transform='rotate({{ angle }}deg) scale(1)'">
                            {{ tag.name }} ({{ tag.posts_count|default(0) }})
                        </a>
                    {% endfor %}
                </div>
            </details>
        {% endif %}
    {% else %}
        <div class="text-gray-500 text-sm italic">暂无标签</div>
    {% endif %}
{% endblock %}
